<style>
    .requests-index-header {
        padding-bottom: 20px !important;
    }
    .main-card, .main-page-card {
        padding: none !important;
        background-color: transparent !important;
    }
    .batches-buttons {
        font-size: 12px;
        padding: 10px;
    }
    #requestCountCard {
        padding-top: 30px;
        padding-bottom: 30px;
        margin-bottom: 0;
    }
    .batch-list-0 {
        position: relative;
        height: 100%;
    }
    .create-batch {
        display: block;
    }
    .batch-search {
        border-left: none !important;
        border-right: none !important;
        border: 1px solid #c5c5c6 !important;
        border-radius: 0;
        border-top-right-radius: .25rem;
        border-bottom-right-radius: .25rem;
        box-shadow: none !important;
        padding-left: 10px !important;
        padding-top: 10px;
        padding-bottom: 10px;
        margin-top: auto !important;
    }
    #supervisorSignature {
        border: none;
        border: 0.5px solid #c5c5c6 !important;
        border-radius: 5px;
        box-shadow: none !important;
        padding-left: 5px !important;
        padding-top: 10px;
        padding-bottom: 10px;
        margin-top: auto !important;
    }
    .modal, .modal-content {
        border-color: #e1e1e2;
    }
    .remove-patient {
        padding-top: 5px;
    }
    .modal-header {
        background-color: #e1e1e2;
        border-bottom-color: #e1e1e2;
    }
    .cancel-create {
        font-size: 14px;
        font-weight: 400px;
        padding: 13px;
    }
    .table-content {
        padding-top: 5px;
        padding-bottom: 5px;
        color: #707071;
        font-size: 13px;
        border-bottom: 1px solid #e1e1e2;
    }
    .table-header-batch {
        border-bottom: 1px solid #e1e1e2;
        padding-top: 10px;
        border-radius: 5px !important;
        padding-bottom: 10px;
        background-color: #e6ebf1;
        color: #59595a;
        font-size: 15px;
    }
    .ellipsis-border {
        padding: 2px;
        border: 1px solid #707071;
    }
    .d--toggle--info {
        border: 1px solid #128193;
    }
    .create-batch, .filter-batch {
        padding-top: 10px !important;
        padding-bottom: 10px !important;
    }
    #placeholder {
        padding-top: 15px;
        padding-bottom: 15px;
    }
    #markPickedUpSpan {
        font-weight: 800px !important;
    }
    #markPickedUp {
        box-shadow: none !important;
    }
    .add-padding-top {
        padding-top: 15px;
    }
    #createButton {
        padding-top: 10px;
    }
    #batchCreation {
        text-align: center !important;
    }
    #batchSearchInput {
        margin-top: 0 !important;
        margin-bottom: 0 !important;
    }
    .hide {
        padding-top: 30px;
    }
    #scrollable {
        height: 100%;
        overflow: hidden;
        box-sizing: border-box;
        width: 100%;
        position: absolute;
        top: 0;
    }
    #scrollableChild {
        position: relative;
        max-height: 100%;
        overflow: auto;
    }
    .search-load {
        padding-top: 30px;
        padding-bottom: 30px;
    }
    .no-match-error {
        padding-top: 20px;
        padding-bottom: 20px;
    }
    #onDutyMDAddon {
        border-right: none !important;
        border-top-right-radius: 0 !important;
        border-bottom-right-radius: 0 !important;
        border-color: #c5c5c6 !important;
    }
    #searchAddon {
        border-right: none !important;
        border-top-right-radius: 0 !important;
        border-bottom-right-radius: 0 !important;
        border-color: #c5c5c6 !important;
    }
    #requestsToday {
        margin-bottom: 10px;
    }
    .submit-search {
        margin-top: 5px;
        padding-top: 10px !important;
        padding-bottom: 10px !important;
    }
    #sendSupervisorName {
        border-left: none !important;
        border-top-left-radius: 0 !important;
        border-bottom-left-radius: 0 !important;
        box-shadow: none !important;
    }
    #btnLoad {
        font-size: 14px !important;
    }
    .requests-index-header {
        opacity: 0.4;
    }
</style>
<div class="requests-index-header">
    <div id="main" class="row" style="padding-left: 0; padding-right: 0;">
        <div class="col-md-12 add-padding-bottom">
            <div class="card">
                <div class="card-body" style="border-radius: 3px;">
                    <h5 class="text-center no-margin-bottom">New orders</h5>
                </div>
            </div>
        </div>
        <div class="col-md-12" id="deliveriesContainer">
            <div class="row" id="liveRequestsUpdate" style="padding-top: 0;">
                <% if @orders.present? %>
                    <%= render partial: 'orders', locals: {orders: @orders} %>
                <% else %>
                    <%= render 'deliveries/no_requests' %>
                <% end %>
            </div>
        </div>
        <!--<div class="col-md-3">-->
        <!--    <div class="row">-->
        <!--        <div class="col-md-12">-->
        <!--            <div id="requestsToday">-->
        <!--                <div class="card " style="margin-bottom: 10px;">-->
        <!--                    <div class="card-header background-transparent">-->
        <!--                        <p class="font-16 white text-center" style="margin-bottom: 0;">New requests</p>-->
        <!--                    </div>-->
        <!--                    <div class="card-body text-center" id="requestCountCard">-->
        <!--                        <div id="requestCountDetails"><span class="font-30 theme-blue semi-bold" id="deliveryRequestsToday"><%= requests_today %></span></div>-->
        <!--                    </div>-->
        <!--                </div>-->
        <!--            </div>-->
        <!--        </div>-->
        <!--        <div class="col-md-12">-->
        <!--            <div class="card">-->
        <!--                <div class="card-header background-transparent white">-->
        <!--                    <p class="font-16 white" style="margin-bottom: 0;">Requests processed</p>-->
        <!--                </div>-->
        <!--                <div class="card-body" style="padding: 0;">-->
        <!--                    <div class="col-md-12" style="border-bottom: 1px solid #ced2da; padding: .75rem 1.25rem;">-->
        <!--                        <p class="font-16">-->
        <!--                            <span class="text-left">Today:</span>-->
        <!--                            <span class="text-right theme-blue count_today"><%= refill_count_today %></span>-->
        <!--                        </p>-->
        <!--                    </div>-->
        <!--                    <div class="col-md-12" style="border-bottom: 1px solid #ced2da; padding: .75rem 1.25rem;">-->
        <!--                        <p class="font-16">-->
        <!--                            <span class="text-left">This week:</span>-->
        <!--                            <span class="text-right theme-blue count_this_week"><%= refill_count_this_week %></span>-->
        <!--                        </p>-->
        <!--                    </div>-->
        <!--                    <div class="col-md-12" style="padding: .75rem 1.25rem;">-->
        <!--                        <p class="font-16">-->
        <!--                            <span class="text-left">This month:</span>-->
        <!--                            <span class="text-right theme-blue count_this_month"><%= refill_count_this_month %></span>-->
        <!--                        </p>-->
        <!--                    </div>-->
        <!--                </div>-->
        <!--            </div>-->
        <!--        </div>-->
        <!--    </div>-->
        <!--</div>-->
    </div>
</div>

<script>
    
    function firstTime() {
        var welcome_modal = document.getElementById('welcomeModal');
        if (welcome_modal == null || welcome_modal == undefined) {
            $('div.requests-index-header').css('opacity', '1');
        }
        $.get('/update_first_time');
    };
    
    firstTime();
    
    function setRequestInvalid(elem) {
        var id = elem.id;
        var status = document.getElementById(id).getAttribute('status');
        var type = document.getElementById(id).getAttribute('type');
        var id_ = id.split('-')[0];
        console.log(id_);
        $.get('/set_invalid_rx?status='+status+'&id='+id_+'&type='+type, e => {
            if (type == 'refill') {
                var refills = $('#refillsToday').text();
                $('#refillsToday').text(parseInt(refills) - 1);
            } else if (type == 'delivery') {
                var deliveries = $('#deliveryRequestsToday').text();
                $('#deliveryRequestsToday').text(parseInt(deliveries) - 1);
            }
        });
    };
    
    function closeModal() {
        $('#welcomeModal').remove();
        $('div.requests-index-header').css('opacity', '1');
    };
    
    function updateRxDob0(elem) {
        var rx = elem.id;
        var dob = document.getElementById('editRxField-'+rx).value;
        if (document.getElementById('editRxDeliveryInstructions-'+rx) != null) {
            var instructions = document.getElementById('editRxDeliveryInstructions-'+rx).value;
        }
        $('.updateRxBtn-'+rx).css('opacity', '0.6');
        $('.updateRxBtn-'+rx).html('Updating...');
        $('#updateRxDobModalBody-'+rx).html(`
            <div class="row">
                <div class="col-md-12 text-center">
                    <i class="fa fa-spinner fa-pulse fa-3x fa-fw theme-blue"></i>
                </div>
                <div class="col-md-12 text-center">
                    <h6 class="font-14">Updating rx</h6>
                </div>
            </div>
        `);
        $.get('/update_rx_dob_pharmacy?dob='+dob+'&instructions='+instructions+'&rx='+rx, function(data) {
            $('#updateRxDobModalBody-'+rx).html(`
                <div class="row">
                    <div class="col-md-12 text-center">
                        <i class="fa fa-check-circle theme-green font-40"></i>
                    </div>
                    <div class="col-md-12 text-center">
                        <h6 class="font-14">Rx details added!</h6>
                    </div>
                    <div class="col-md-12 text-center">
                        <button class="btn btn-info transaction-buttons" id="`+rx+`"
                        onclick="clearRxUpdate(this)"><i class="fa fa-times-circle"></i> Clear</button>
                    </div>
                </div>
            `);
            $('.updateRxBtn-'+rx).css('opacity', '1');
            $('.updateRxBtn-'+rx).html('<i class="fa fa-check-circle"></i> Update');
        });
    };
    
    function clearRxUpdate(elem) {
        var rx = elem.id;
        $('#updateRxDobModalBody-'+rx).html(`
            <div class="row">
                <div class="col-md-12" style="padding-bottom: 10px;">
                    <h6 class="font-14 theme-blue">If the following rx exists, confirm the birth year (from your records)</h6>
                    <h6 class="font-14 theme-yellow text-center add-padding-top bold">Rx #<span id="rxSpan">`+rx+`</span></h6>
                </div>
                <div class="col-md-8 offset-md-2">
                    <input type="text" class="form-control font-14" id="editRxField-`+rx+`" placeholder="birth year (format: yyyy)">
                    <div class="add-padding-top"></div>
                </div>
            </div>
        `);
    };
    
    function loadRequestCount() {
        $('#requestCountDetails').hide();
        $('#requestCountLoader').show();
        $.get('/deliveries_today', function(data) {
            $('#requestCountLoader').hide();
            $('#requestNumber').html(data);
            $('#requestCountDetails').show();
        });
    };
    
    var form = document.getElementById('supervisorForm');
    form.addEventListener('submit', function(event) {
        event.preventDefault();
        var signatureName = document.getElementById('supervisorSignature');
        var value = signatureName.value;
        var id = <%= current_pharmacy.id %>
        
        $('#sendSupervisorName').html('<i class="fa fa-circle-o-notch white fa-spin fa-3x fa-fw" id="btnLoad"></i>');
        $.get('/update_supervisor?pharmacist='+value+'&pharmacy_id='+id.toString(), function(data) {
            signatureName.value = '';
        });
    });
    
    $('.btn-danger').on('click', function() {
        console.log($(this).text());
        var text = $(this).text().toLowerCase();
        if (text.includes('cancel')) {
            $(this).html('cancelling...please wait');
        }
    });
  
</script>